name: Example Plugin Updater

# Run this workflow twice daily
on:
  # schedule:
  #   - cron: '0 */12 * * *'
  workflow_dispatch:

env:
  PACKAGE_SLUG: example-plugin

jobs:
  # Set the job key. The key is displayed as the job name
  # when a job name is not provided
  update:
    # Name the Job
    name: Fetch and check versions
    # Set the type of machine to run on
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Fetch latest version
      - name: Fetch
        run: wget 'https://privateplugin.example&k=${{secrets.PLUGIN_KEY}}' -O package.zip

      # Get the latest plugin and compare versions, commit if necessary
      - uses: ./.github/actions/update-plugin
        name: Update WordPress Plugin
        with:
          package-slug: ${{ env.PACKAGE_SLUG }}
          package-file-name: package.zip
